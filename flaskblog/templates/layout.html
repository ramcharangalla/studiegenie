<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}">

<script src="http://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='d3.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='d3.layout.cloud.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='tags.js') }}"></script>

    <style>
    .add-on .input-group-btn > .btn {
  border-left-width:0;left:-2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
/* stop the glowing blue shadow */
.add-on .form-control:focus {
 box-shadow:none;
 -webkit-box-shadow:none; 
 border-color:#cccccc; 
}
.form-control{width:20%}
.navbar-nav > li > a {
  border-right: 1px solid #ddd;
  padding-bottom: 15px;
  padding-top: 15px;
}
.navbar-nav:last-child{ border-right:0}
    .container {
      display: table;
      width: 100%;
    }

    .div1 {
      background-color: #fafafa;
      position: absolute;
      left: 10px;
      width: 20%;
      height: 100%
    }

    .div2 {
      background-color: #fafafa;
      position: absolute;
      right: 0px;
      width: 80%;
      height: 100%
    }
    .div3 {
      background-color: #fafafa;
      position: absolute;
      left: 0px;
      width: 65%;
      height: 100%
    }
    .div4 {
      background-color: #fafafa;
      position: absolute;
      right:0px;
      width: 25%;
      height: 100%
    }
    .col-md-8 {
      margin-left: auto;
      margin-right: auto;
      margin-top: auto;
      margin-bottom: auto;
    }
    </style>
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart()
      {
        var jax = new XMLHttpRequest();
        jax.onreadystatechange = function()
        {
          if (jax.readyState == XMLHttpRequest.DONE)
          {
            res_data = jax.responseText;
            console.log(res_data);
            var my_addrows = []
            my_addrows.push(['Topic', 'Count'])
            var mappings = res_data.split(';');
            var data = new google.visualization.DataTable();
              data.addColumn('string', 'Topic');
              data.addColumn('number', 'Count');
              for (var i = 0; i < mappings.length; i++)
              {
                  // console.log(mappings[i])
                  var temp = mappings[i].split(',');
                  var temp2 = []

                    temp2.push(temp[0]);
                    temp2.push(parseInt(temp[1]));
                    my_addrows.push(temp2);
                    // console.log(temp2);
              }
            var chart = new google.visualization.PieChart(document.getElementById('piecharts'));

            var Sneha = google.visualization.arrayToDataTable(my_addrows);
            chart.draw(Sneha);
          }
        }
        jax.open("GET","http://localhost:5000/piechart");
        jax.send();



      }
    </script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['sankey']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart()
      {
        var jax = new XMLHttpRequest();
        jax.onreadystatechange = function() 
        {
          if (jax.readyState == XMLHttpRequest.DONE) 
          {
        res_data = jax.responseText;
        var data = new google.visualization.DataTable();
          data.addColumn('string', 'From');
          data.addColumn('string', 'To');
          data.addColumn('number', 'Weight');
          var my_addrows = []
        var mappings = res_data.split(';');
        for (var i = 0; i < mappings.length; i++) {
            var temp = mappings[i].split(',');
            var temp2 = []
            if (typeof temp[2] != 'undefined') 
            {
              temp2.push(temp[0]);
              temp2.push(temp[1]);
              temp2.push(Number(temp[2]));
              console.log(temp2);
            }
            if(temp2.length == 3){
            my_addrows.push(temp2);
            } 
        }
          
          // data.addRows([
          //   [ 'Manoj', 'Charan', 4 ],
          //   [ 'Manoj', 'Hitesh', 7 ],
          //   [ 'Manoj', 'Raghu', 5 ],
          //   [ 'Sneha', 'Charan', 9 ],
          //   [ 'Sneha', 'Hitesh', 4 ],
          //   [ 'Sneha', 'Raghu', 3 ]
          // ]);
          console.log(my_addrows);
          data.addRows(my_addrows);


          var chart = new google.visualization.Sankey(document.getElementById('sankey_basic'));
          chart.draw(data);

          }
        }
        jax.open("GET","http://localhost:5000/getUserSimilarity");
        jax.send();
      }
    </script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawVisualization);
      function drawVisualization()
      {
          var jax = new XMLHttpRequest();
          jax.onreadystatechange = function() {
        if (jax.readyState == XMLHttpRequest.DONE) {
      data = jax.responseText;

        // Some raw data (not necessarily accurate)
        var data = google.visualization.arrayToDataTable([
          ['User', 'Inheritence', 'If case', 'React', 'Switch case', 'Loops', 'Sorting'],
          ['Sneha',  9,      8,         1,             3,           5,      1],
          ['Manoj',  4,      5,        9,             3,          7,      9],
          ['Charan',  9,      7,        2,             5,           7,      2],
          ['Hitesh',  8,      2,        9,             3,           2,      1],
          ['Raghu',  1,      4,         8,             4,          2,      6]
        ]);

        var options = {
          vAxis: {title: 'Count'},
          hAxis: {title: 'Users'},
          seriesType: 'bars',
          series: {5: {type: 'line'}}
        };
        var chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
        chart.draw(data, options);
        }
        }
    jax.open("GET","http://localhost:5000/getUserSimilarity");
        jax.send();
      }
    </script>
</head>
<body>
    <header class="site-header">
    {% if current_user.is_authenticated %}
      <nav class="navbar navbar-expand-md navbar-dark bg-steel fixed-top">
        <div class="container">
          <div class="collapse navbar-collapse" id="navbarToggle">
            <div class="navbar-nav mr-auto">
            </div>
            <!-- Navbar Right Side -->
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="{{ url_for('home') }}">Home</a>&nbsp&nbsp
                <a class="nav-item nav-link" href="{{ url_for('new_note') }}">Create Note</a>&nbsp&nbsp
                <a class="nav-item nav-link" href="{{ url_for('account') }}">Account</a>&nbsp&nbsp
                <a class="nav-item nav-link" href="{{ url_for('logout') }}">Logout</a>&nbsp&nbsp&nbsp
                <a class="nav-item nav-link">Hi {{ current_user.firstname }} !</a>
                <form class="navbar-form" role="search" action="/search">
    <div class="input-group add-on">
      <input class="form-control" placeholder="Search" name="srch-term" id="srch-term" type="text">
      <div class="input-group-btn">
        <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
      </div>
    </div>
  </form>
            </div>
          </div>
        </div>
      </nav>
    {% endif %}
    </header>
    <section class="container">
       <div class="div1">
         <div class="article-metadata">
           <h3>Trending Notes</h3>
        </div>
           <br><br>


        {% for note in notes_trending %}
          <article class="media content-section">
            <div class="media-body">
              <div class="article-metadata">
                <a class="mr-2" href="{{ url_for('user_notes', user_id=note.author.id) }}">{{ note.author.firstname }}</a>&nbsp&nbsp
              {% for n in note.notetags %}
                <a class="mr-2" href="{{ url_for('tags', tag_id=n.id) }}">{{ n.name }}</a>
              {% endfor %}
              </div>
              <h6><a class="article-title" href="{{ url_for('note', note_id=note.id) }}">{{ note.title }}</a></h6><br>
              </div>
          </article>
        {% endfor %}
        </div>
       <div class="div2">
         <div class="div3">
         <main role="main" class="container">
           <!-- <div class="row"> -->
             <!-- <div class="col-md-8"> -->
                 <!-- {% with messages = get_flashed_messages(with_categories=true) %}
                 {% if messages %}
                     {% for category, message in messages %}
                     <div class="alert alert-{{ category }}">
                         {{ message }}
                     </div>
                     {% endfor %}
                 {% endif %}
                 {% endwith %} -->
                 {% block content %}{% endblock %}
                 <!-- </div> -->
           <!-- </div> -->
         </main>
          </div>
          

          <div id='vis' class="div4" >

           <script type="text/javascript" src="{{ url_for('static', filename='word-cloud.js') }}"></script>

           <br><br><br><br>
           <p align="center">User vs User Similarity</p>
           <div id="sankey_basic" style="width: 100%; height: 100%;"></div>
           <br><br>
           <p align="center">User vs No of Notes</p>
           <div id="piecharts" style="width: 100%; height: 100%;"></div>
           
           <br><br>
           
          </div>
       </div>
    </section>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>
